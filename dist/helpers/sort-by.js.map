{"version":3,"file":"sort-by.js","sources":["../../src/helpers/sort-by.ts"],"sourcesContent":["import { get } from '@ember/object';\nimport { isEmpty } from '@ember/utils';\nimport { helper } from '@ember/component/helper';\nimport EmberArray from '@ember/array';\nimport asArray from '../utils/as-array.ts';\n\nconst collator = new Intl.Collator(undefined, {\n  sensitivity: 'base',\n});\n\nfunction normalizeToBoolean(val: boolean | number | void): boolean {\n  if (typeof val === 'boolean') {\n    return val;\n  }\n\n  if (typeof val === 'number') {\n    if (val > 0) {\n      return false;\n    } else if (val < 0) {\n      return true;\n    }\n  }\n\n  return val as unknown as boolean;\n}\n\nfunction safeValueForKey(ctx: unknown, key: string) {\n  if (ctx === null || ctx === undefined) {\n    return ctx;\n  }\n  return get(ctx, key);\n}\n\nfunction sortDesc<T>(key: string, a: T, b: T) {\n  if (isEmpty(key)) {\n    return 0;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const aValue = safeValueForKey(a, key) as any;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const bValue = safeValueForKey(b, key) as any;\n\n  const isANullable = typeof aValue == 'undefined' || aValue === null;\n  const isBNullable = typeof bValue == 'undefined' || bValue === null;\n\n  if (isANullable && isBNullable) {\n    //both values are nullable\n    return 0;\n  }\n\n  if (isBNullable) {\n    // keep bValue last\n    return -1;\n  }\n  if (isANullable) {\n    // put aValue last\n    return 1;\n  }\n\n  if (aValue.toLowerCase && bValue.toLowerCase) {\n    return collator.compare(bValue, aValue);\n  }\n\n  if (aValue < bValue) {\n    return 1;\n  } else if (aValue > bValue) {\n    return -1;\n  }\n\n  return 0;\n}\n\nfunction sortAsc<T>(key: string, a: T, b: T) {\n  if (isEmpty(key)) {\n    return 0;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const aValue = safeValueForKey(a, key) as any;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const bValue = safeValueForKey(b, key) as any;\n\n  const isANullable = typeof aValue == 'undefined' || aValue === null;\n  const isBNullable = typeof bValue == 'undefined' || bValue === null;\n\n  if (isANullable && isBNullable) {\n    //both values are nullable\n    return 0;\n  }\n\n  if (isBNullable) {\n    // keep bValue last\n    return -1;\n  }\n  if (isANullable) {\n    // put aValue last\n    return 1;\n  }\n\n  if (aValue.toLowerCase && bValue.toLowerCase) {\n    return collator.compare(aValue, bValue);\n  }\n\n  if (aValue < bValue) {\n    return -1;\n  } else if (aValue > bValue) {\n    return 1;\n  }\n\n  return 0;\n}\n\nclass SortBy<T> {\n  array: T[];\n\n  constructor(...args: [T[] | EmberArray<T>]) {\n    let [array] = args;\n    if (typeof (array as EmberArray<T>).toArray === 'function') {\n      array = (array as EmberArray<T>).toArray();\n    }\n\n    this.array = [...(array as T[])];\n  }\n\n  comparator(key: string | ((a: T, b: T) => number)) {\n    return typeof key === 'function' ? key : this.defaultSort(key);\n  }\n\n  defaultSort(sortKey: string) {\n    let func = sortAsc;\n    if (sortKey.match(':desc')) {\n      func = sortDesc;\n    }\n\n    return (a: T, b: T) => func(sortKey.replace(/:desc|:asc/, ''), a, b);\n  }\n}\n\n/**\n * best O(n); worst O(n^2)\n * If we feel like swapping with something more performant like QuickSort or MergeSort\n * then it should be easy\n *\n * @class BubbleSort\n * @extends SortBy\n */\nclass BubbleSort<T> extends SortBy<T> {\n  perform(keys: string[] = []) {\n    let swapped = false;\n\n    const compFuncs = keys.map((key) => this.comparator(key));\n    const compFunc = (a: T, b: T) => {\n      for (let i = 0; i < compFuncs.length; i += 1) {\n        const result = compFuncs[i]?.(a, b);\n        if (result === 0) {\n          continue;\n        }\n        return result;\n      }\n      return 0;\n    };\n    for (let i = 1; i < this.array.length; i += 1) {\n      for (let j = 0; j < this.array.length - i; j += 1) {\n        const shouldSwap = normalizeToBoolean(\n          compFunc(this.array[j + 1]!, this.array[j]!),\n        );\n        if (shouldSwap) {\n          [this.array[j], this.array[j + 1]] = [\n            this.array[j + 1]!,\n            this.array[j]!,\n          ];\n\n          swapped = true;\n        }\n      }\n\n      // no need to continue sort if not swapped in any inner iteration\n      if (!swapped) {\n        return this.array;\n      }\n    }\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function sortBy<T, K extends string | `${string}:desc`>(\n  params: [...K[], T[]],\n) {\n  // slice params to avoid mutating the provided params\n  const sortParams = params.slice();\n  const array = asArray(sortParams.pop() as T[]);\n  let sortKeys = sortParams as K[];\n\n  if (!array || !sortKeys || sortKeys.length === 0) {\n    return [];\n  }\n\n  if (sortKeys.length === 1 && Array.isArray(sortKeys[0])) {\n    sortKeys = sortKeys[0];\n  }\n\n  const sortKlass = new BubbleSort(array);\n  sortKlass.perform(sortKeys);\n  return sortKlass.array;\n}\n\nexport default helper(sortBy);\n"],"names":["collator","Intl","Collator","undefined","sensitivity","normalizeToBoolean","val","safeValueForKey","ctx","key","get","sortDesc","a","b","isEmpty","aValue","bValue","isANullable","isBNullable","toLowerCase","compare","sortAsc","SortBy","array","constructor","args","toArray","comparator","defaultSort","sortKey","func","match","replace","BubbleSort","perform","keys","swapped","compFuncs","map","compFunc","i","length","result","j","shouldSwap","sortBy","params","sortParams","slice","asArray","pop","sortKeys","Array","isArray","sortKlass","helper"],"mappings":"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"}