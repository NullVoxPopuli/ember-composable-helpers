{"version":3,"file":"as-array.js","sources":["../../src/utils/as-array.ts"],"sourcesContent":["import EmberArray, { isArray } from '@ember/array';\nimport EmberObject, { get } from '@ember/object';\n\nimport type ArrayProxy from '@ember/array/proxy';\n\nfunction isIterable(value: unknown) {\n  return Symbol.iterator in Object(value);\n}\n\n// from https://github.com/flexyford/ember-power-select/blob/78a5430c1ac89daf315d0801fd5201e444e82434/addon/components/power-select.ts\nfunction isArrayable<T>(thing: unknown): thing is EmberArray<T> {\n  return typeof (thing as EmberArray<T>).toArray === 'function';\n}\n\nfunction isPromiseLike<T>(thing: unknown) {\n  return typeof (thing as Promise<T>).then === 'function';\n}\n\nfunction isPromiseProxyLike<T>(thing: unknown): thing is ArrayProxy<T> {\n  return (\n    isPromiseLike(thing as Promise<T>) &&\n    Object.hasOwnProperty.call(thing, 'content')\n  );\n}\n\nfunction toExtendable<T>(array: T[]) {\n  if (!Object.isExtensible(array)) {\n    return Array.from(array);\n  } else {\n    return array;\n  }\n}\n\nexport default function asArray<T>(maybeArray: T[]): T[] {\n  return toExtendable(_asArray(maybeArray));\n}\n\nfunction _asArray<T>(maybeArray: unknown): T[] {\n  if (typeof maybeArray === 'number') {\n    throw new Error(\n      'Numbers not supported as arrays [ember-composable-helpers]',\n    );\n  }\n  if (typeof maybeArray === 'string') {\n    return maybeArray.split('') as T[];\n  }\n  // for perf-reasons falling back to e-array, instead of using it first\n  if (Array.isArray(maybeArray)) {\n    return maybeArray;\n  } else if (isArray(maybeArray)) {\n    return maybeArray as T[];\n  } else if (typeof maybeArray === 'object' && maybeArray === null) {\n    return [];\n  } else if (typeof maybeArray === 'undefined') {\n    return [];\n  } else if (maybeArray instanceof Set) {\n    return Array.from(maybeArray.values());\n  } else if (maybeArray instanceof Map) {\n    return Array.from(maybeArray.values());\n  } else if (maybeArray instanceof WeakMap) {\n    throw new Error(\n      'WeakMaps is not supported as arrays [ember-composable-helpers]',\n    );\n  } else if (maybeArray instanceof WeakSet) {\n    throw new Error(\n      'WeakSets is not supported as arrays [ember-composable-helpers]',\n    );\n  }\n  if (typeof maybeArray === 'object') {\n    if (isPromiseProxyLike(maybeArray)) {\n      // eslint-disable-next-line ember/no-get -- TODO: Revisit this\n      const content = get(maybeArray, 'content');\n      if (typeof content !== 'object' || content === null) {\n        throw new Error(\n          'Unknown content type in array-like object [ember-composable-helpers]',\n        );\n      }\n      if (isArrayable(content)) {\n        return (content as EmberArray<T>).toArray();\n      } else {\n        return _asArray(content);\n      }\n    }\n    if (isPromiseLike(maybeArray)) {\n      throw new Error(\n        'Promise-like objects is not supported as arrays [ember-composable-helpers]',\n      );\n    }\n    if (isArrayable(maybeArray)) {\n      return (maybeArray as EmberArray<T>).toArray();\n    }\n    if (maybeArray instanceof EmberObject) {\n      throw new Error(\n        'EmberObjects is not supported as arrays [ember-composable-helpers]',\n      );\n    }\n    return Array.from(Object.values(maybeArray));\n  }\n  if (!maybeArray) {\n    return [];\n  }\n  if (!isIterable(maybeArray)) {\n    throw new Error(\n      'Argument, passed as array is not iterable [ember-composable-helpers]',\n    );\n  }\n  return maybeArray as T[];\n}\n"],"names":["isIterable","value","Symbol","iterator","Object","isArrayable","thing","toArray","isPromiseLike","then","isPromiseProxyLike","hasOwnProperty","call","toExtendable","array","isExtensible","Array","from","asArray","maybeArray","_asArray","Error","split","isArray","Set","values","Map","WeakMap","WeakSet","content","get","EmberObject"],"mappings":"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"}